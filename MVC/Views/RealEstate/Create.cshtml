@using Core.Enums
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model CreateRealEstateViewModel

@{
    ViewData["Title"] = "Add New Property";
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="bi bi-plus-circle me-2"></i>Add New Property</h4>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post" enctype="multipart/form-data">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <!-- Basic Information -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">Basic Information</h5>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Title" class="form-label">Property Title *</label>
                                <input asp-for="Title" class="form-control" placeholder="e.g., Spacious 2-bedroom apartment">
                                <span asp-validation-for="Title" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Category" class="form-label">Category *</label>
                                <select asp-for="Category" class="form-select">
                                    <option value="">Select Category</option>
                                    @foreach (var category in Enum.GetValues<RealEstateCategoryEnum>())
                                    {
                                        <option value="@category">@category</option>
                                    }
                                </select>
                                <span asp-validation-for="Category" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="RealtyType" class="form-label">Property Type *</label>
                                <select asp-for="RealtyType" class="form-select">
                                    <option value="">Select Property Type</option>
                                    @foreach (var type in Enum.GetValues<RealEstateTypeEnum>())
                                    {
                                        <option value="@type">@type</option>
                                    }
                                </select>
                                <span asp-validation-for="RealtyType" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Deal" class="form-label">Deal Type *</label>
                                <select asp-for="Deal" class="form-select">
                                    <option value="">Select Deal Type</option>
                                    @foreach (var deal in Enum.GetValues<DealTypeEnum>())
                                    {
                                        <option value="@deal">@deal</option>
                                    }
                                </select>
                                <span asp-validation-for="Deal" class="text-danger"></span>
                            </div>
                            <div class="col-12 mb-3">
                                <label asp-for="Description" class="form-label">Description *</label>
                                <textarea asp-for="Description" class="form-control" rows="4"
                                          placeholder="Describe your property in detail..."></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    <input asp-for="IsNewBuilding" class="form-check-input">
                                    <label asp-for="IsNewBuilding" class="form-check-label">New Building</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="NewBuildingName" class="form-label">Building Name (if applicable)</label>
                                <input asp-for="NewBuildingName" class="form-control" placeholder="Building complex name">
                                <span asp-validation-for="NewBuildingName" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Location -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">Location</h5>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Country" class="form-label">Country *</label>
                                <input asp-for="Country" class="form-control" placeholder="e.g., Ukraine">
                                <span asp-validation-for="Country" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Region" class="form-label">Region *</label>
                                <input asp-for="Region" class="form-control" placeholder="e.g., Kyiv Oblast">
                                <span asp-validation-for="Region" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Locality" class="form-label">City *</label>
                                <input asp-for="Locality" class="form-control" placeholder="e.g., Kyiv">
                                <span asp-validation-for="Locality" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Borough" class="form-label">District/Borough</label>
                                <input asp-for="Borough" class="form-control" placeholder="e.g., Pechersk">
                                <span asp-validation-for="Borough" class="text-danger"></span>
                            </div>
                            <div class="col-md-8 mb-3">
                                <label asp-for="Street" class="form-label">Street Address *</label>
                                <input asp-for="Street" class="form-control" placeholder="e.g., Khreshchatyk Street 10">
                                <span asp-validation-for="Street" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="StreetType" class="form-label">Street Type</label>
                                <input asp-for="StreetType" class="form-control" placeholder="e.g., Street, Avenue">
                                <span asp-validation-for="StreetType" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Latitude" class="form-label">Latitude (optional)</label>
                                <input asp-for="Latitude" class="form-control" type="number" step="any" placeholder="50.4501">
                                <span asp-validation-for="Latitude" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Longitude" class="form-label">Longitude (optional)</label>
                                <input asp-for="Longitude" class="form-control" type="number" step="any" placeholder="30.5234">
                                <span asp-validation-for="Longitude" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Property Details -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">Property Details</h5>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="RoomCount" class="form-label">Number of Rooms *</label>
                                <input asp-for="RoomCount" class="form-control" type="number" min="1" max="50">
                                <span asp-validation-for="RoomCount" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="Floor" class="form-label">Floor *</label>
                                <input asp-for="Floor" class="form-control" type="number" min="1" max="200">
                                <span asp-validation-for="Floor" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="TotalFloors" class="form-label">Total Floors *</label>
                                <input asp-for="TotalFloors" class="form-control" type="number" min="1" max="200">
                                <span asp-validation-for="TotalFloors" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="AreaTotal" class="form-label">Total Area (m²) *</label>
                                <input asp-for="AreaTotal" class="form-control" type="number" step="0.1" min="1">
                                <span asp-validation-for="AreaTotal" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="AreaLiving" class="form-label">Living Area (m²)</label>
                                <input asp-for="AreaLiving" class="form-control" type="number" step="0.1" min="1">
                                <span asp-validation-for="AreaLiving" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="AreaKitchen" class="form-label">Kitchen Area (m²)</label>
                                <input asp-for="AreaKitchen" class="form-control" type="number" step="0.1" min="1">
                                <span asp-validation-for="AreaKitchen" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Price -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">Price</h5>
                            </div>
                            <div class="col-md-8 mb-3">
                                <label asp-for="Price" class="form-label">Price *</label>
                                <input asp-for="Price" class="form-control" type="number" min="1" step="0.01">
                                <span asp-validation-for="Price" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="Currency" class="form-label">Currency *</label>
                                <select asp-for="Currency" class="form-select">
                                    <option value="">Select Currency</option>
                                    @foreach (var currency in Enum.GetValues<CurrencyEnum>())
                                    {
                                        <option value="@currency">@currency</option>
                                    }
                                </select>
                                <span asp-validation-for="Currency" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Images -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">Photos</h5>
                            </div>
                            <div class="col-12 mb-3">
                                <label asp-for="Images" class="form-label">Property Images</label>
                                <input asp-for="Images" class="form-control" type="file" multiple accept="image/*">
                                <div class="form-text">You can select multiple images. Supported formats: JPG, PNG, GIF</div>
                                <span asp-validation-for="Images" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <a asp-action="Index" class="btn btn-outline-secondary">
                                        <i class="bi bi-arrow-left me-2"></i>Cancel
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-check-circle me-2"></i>Add Property
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        // Preview selected images
        document.querySelector('input[type="file"]').addEventListener('change', function(e) {
            const files = e.target.files;
            const preview = document.querySelector('#image-preview');

            if (preview) preview.remove();

            if (files.length > 0) {
                const previewDiv = document.createElement('div');
                previewDiv.id = 'image-preview';
                previewDiv.className = 'mt-3';

                for (let i = 0; i < Math.min(files.length, 5); i++) {
                    const file = files[i];
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'img-thumbnail me-2 mb-2';
                        img.style.width = '100px';
                        img.style.height = '100px';
                        img.style.objectFit = 'cover';
                        previewDiv.appendChild(img);
                    };

                    reader.readAsDataURL(file);
                }

                e.target.parentNode.appendChild(previewDiv);
            }
        });

        // Auto-calculate total floors based on floor if not set
        document.querySelector('input[name="Floor"]').addEventListener('change', function() {
            const floorInput = this;
            const totalFloorsInput = document.querySelector('input[name="TotalFloors"]');

            if (totalFloorsInput.value === '' || parseInt(totalFloorsInput.value) < parseInt(floorInput.value)) {
                totalFloorsInput.value = floorInput.value;
            }
        });
    </script>
}